@model flashcardApp.Models.FlashcardSet
@{
    ViewData["Title"] = "Set: " + Model.Title;
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Set: @Model.Title</h1>
        <div>
            <a asp-action="Set" asp-route-id="@Model.Id" class="btn btn-outline-secondary">Sete geri dön</a>
        </div>
    </div>

    @if (!Model.Flashcards.Any())
    {
        <div class="alert alert-warning">
            Bu set henüz hiç kart içermiyor. 
            @if (User.Identity.IsAuthenticated && int.TryParse(User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value, out int userId) && userId == Model.UserId)
            {
                <a asp-action="Edit" asp-route-id="@Model.Id">Hemen ekle!</a>
            }
            else
            {
                <span>Daha sonra tekrar deneyiniz.</span>
            }
        </div>
    }
    else
    {
        <div class="row mb-4">
            <div class="col-md-8 mx-auto">
                <div class="card" id="flashcard">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <span>Kart <span id="currentCardIndex">1</span> of <span id="totalCards">@Model.Flashcards.Count</span></span>
                        <div>
                            <button id="shuffleBtn" class="btn btn-sm btn-light">
                                <i class="bi bi-shuffle"></i> Karıştır
                            </button>
                        </div>
                    </div>                    <div class="card-body text-center" style="min-height: 300px; position: relative;">
                        <!-- Card front with term -->
                        <div id="cardFront" style="position: absolute; width: 100%; top: 0; bottom: 0; left: 0; right: 0; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                            <h3 id="termText" style="margin-bottom: 20px;"></h3>
                            <div id="imageContainer" class="mt-3" style="max-height: 200px; display: none;">
                                <img id="cardImage" class="img-fluid" style="max-height: 200px;">
                            </div>
                        </div>
                        <!-- Card back with definition -->
                        <div id="cardBack" style="position: absolute; width: 100%; top: 0; bottom: 0; left: 0; right: 0; display: none; flex-direction: column; justify-content: center; align-items: center;">
                            <p id="definitionText" class="lead" style="margin-bottom: 20px;"></p>
                            <p id="exampleText" class="text-muted fst-italic"></p>
                        </div>
                    </div>
                    <div class="card-footer text-center">
                        <button id="flipBtn" class="btn btn-primary">Kartı çevir</button>
                        <div class="mt-3">
                            <button id="prevBtn" class="btn btn-outline-secondary" disabled>Önceki</button>
                            <button id="nextBtn" class="btn btn-outline-secondary">Sonraki</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        // Initialize global flashcards array with clean JSON data
        window.flashcards = [
            @foreach(var card in Model.Flashcards)
            {
                @:{ 
                @:  id: @card.Id,
                @:  term: @Json.Serialize(card.Term),
                @:  definition: @Json.Serialize(card.Definition),
                @:  imageUrl: @Json.Serialize(card.ImageUrl),
                @:  exampleSentence: @Json.Serialize(card.ExampleSentence)
                @:},
            }
        ];
        
        console.log("Flashcards loaded:", window.flashcards);
        </script>
    <!-- All functionality is now in the study-page-handler.js file -->
    <script src="~/js/study-page-handler.js"></script>
}
